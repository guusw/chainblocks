#!/bin/bash

set -e

CHAINBLOCKS_BUILD_DIR_NAME=${CHAINBLOCKS_BUILD_DIR_NAME:-build}

export CHAINBLOCKS_ROOT_PATH=$(realpath $(dirname ${BASH_SOURCE[0]})/..)
export CHAINBLOCKS_BUILD_PATH=$CHAINBLOCKS_ROOT_PATH/$CHAINBLOCKS_BUILD_DIR_NAME

while getopts "v" opt; do
  echo "OPT: $opt"
  case $opt in
    "v")
      export CHAINBLOCKS_SCRIPT_VERBOSE=1
      echo "Running scripts with verbose output"
    ;;
  esac
done

[ -n "$CHAINBLOCKS_SCRIPT_VERBOSE" ] && echo "CHAINBLOCKS_ROOT_PATH=$CHAINBLOCKS_ROOT_PATH"
[ -n "$CHAINBLOCKS_SCRIPT_VERBOSE" ] && echo "CHAINBLOCKS_BUILD_PATH=$CHAINBLOCKS_BUILD_PATH"

if [ ! -z "${GITHUB_PATH-}" ]; then
  echo "CHAINBLOCKS_ROOT_PATH=$CHAINBLOCKS_ROOT_PATH" >>$GITHUB_PATH
  echo "CHAINBLOCKS_BUILD_PATH=$CHAINBLOCKS_BUILD_PATH" >>$GITHUB_PATH
fi
